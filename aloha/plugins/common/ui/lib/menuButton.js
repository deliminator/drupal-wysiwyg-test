define(["jquery","ui/component","ui/utils","jqueryui"],function(e,t,n){function r(t,s){var o=[];return e.each(s,function(s,u){var a=e("<li>");a.append(e("<a>",{href:"javascript:void 0",html:n.makeButtonLabelWithIcon(u)})),u.click&&a.data("aloha-ui-menubutton-select",function(){t(),u.click()});if(u.menu){var f=e("<ul>").appendTo(a);f.append(r(i(f,t),u.menu))}o.push(a[0])}),o}function i(t,n){return n=n||e.noop,function(){t.blur().hide(),t.parent().removeClass("aloha-ui-menubutton-pressed"),n()}}function s(e,t){var n=t.item.data("aloha-ui-menubutton-select");n&&n(e,t),e.preventDefault()}var o=t.extend({init:function(){this.element=o.makeMenuButton(this)}});return o.makeMenuButton=function(t){function o(e){e.hide().parent().removeClass("aloha-ui-menubutton-pressed")}var u=e("<div>",{"class":"aloha-ui-menubutton-container"}),a=n.makeButtonElement({"class":"aloha-ui-menubutton-expand"}),f=e("<ul>",{"class":"aloha-ui-menubutton-menu"}),l=null,c=null;return e.browser.msie&&u.addClass("aloha-ui-menubutton-iehack"
),t.click?(l=n.makeButton(n.makeButtonElement({"class":"aloha-ui-menubutton-action"}),t).click(t.click),n.makeButton(a,{},!0),c=e("<div>").buttonset().append(l).append(a)):n.makeButton(a,t,!0).addClass("aloha-ui-menubutton-single"),t.menu?(a.click(function(){u.addClass("aloha-ui-menubutton-pressed"),t.siblingContainer&&t.siblingContainer.find(".aloha-ui-menubutton-menu").each(function(){this!==f[0]&&o(e(this))});if(f.is(":visible")){o(f);return}return f.show().position({my:"left top",at:"left bottom",of:l||a}),e(document).bind("click",function(t){e(this).unbind(t),f.hide(),u.removeClass("aloha-ui-menubutton-pressed")}),!1}),u.append(c||a).append(f),f.append(r(i(f),t.menu)),f.hide().menu({select:s}),u):u.append(l)},o})