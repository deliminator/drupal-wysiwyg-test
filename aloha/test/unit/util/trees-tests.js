Aloha.require(["jquery","util/trees"],function(e,t){function n(t){return"string"===e.type(t)?t.toUpperCase():t+10}function r(e){return"DEF".indexOf(e)!=-1||e>10}function i(t){return"string"===e.type(t)||"number"===e.type(t)}function s(t,n){if(i(t))return n!==r(t)?200:t;if("array"===e.type(t))return i(t[0])&&n!==r(t[0])?100:t.concat("@");if("object"===e.type(t)){for(var s in t)if(t.hasOwnProperty(s))return i(t[s])&&n!==r(t[s])?100:e.extend({"%":"%"},t);return 300}return null}function o(t,n){return i(t)?n.indexOf(t)!=-1:"array"===e.type(t)?!t.length:!1}var u={tree:[{array:[1,2,3],map:{a:4,b:5,c:6}},[{array:["d","e","f"],g:7,h:8,i:9}]]},a=[1,2,3,4,5,6,"d","e","f",7,8,9],f={tree:[{array:[11,12,13,"@"],map:{a:14,b:15,c:16,"%":"%"},"%":"%"},[{array:["D","E","F","@"],g:17,h:18,i:19,"%":"%"},"@"],"@"],"%":"%"},l={tree:[{array:[1,2,3],map:{a:4,b:5,c:6}},[{array:[],g:7,h:8,i:9}]]},c={tree:[{array:[1,2,3],map:{a:4,b:5,c:6}},[{g:7,h:8,i:9}]]};module("Trees"),test("clone",function(){var e=t.clone(u)
,n=t.clone(u);deepEqual(e,u),deepEqual(n,u),ok(e!==n&&e!==u&&n!==u)}),test("flatten",function(){var e=t.flatten(u);e.sort();var n=a.slice();n.sort(),deepEqual(e,n)}),test("prewalk, postwalk",function(){var e=t.prewalk(u,function(e){return e=s(e,!1),i(e)&&(e=n(e)),e}),r=t.postwalk(u,function(e){return i(e)&&(e=n(e)),s(e,!0)});deepEqual(e,f),deepEqual(r,f)}),test("preprune, postprune",function(){var e=t.preprune(u,function(e){return o(e,"def")}),n=t.postprune(u,function(e){return o(e,"def")});deepEqual(e,l),deepEqual(n,c)}),test("simple prewalk inplace, postwalk inplace",function(){var e={a:"a",b:"b",c:"c"},n={a:"Xa",b:"Xb",c:"Xc"},r=t.clone(e),i=t.clone(e),s=t.prewalk(r,function(e){return typeof e=="string"&&(e="X"+e),e},!0),o=t.postwalk(i,function(e){return typeof e=="string"&&(e="X"+e),e},!0);deepEqual(s,r),deepEqual(s,n),deepEqual(o,i),deepEqual(o,n)}),test("more complex prewalk inplace, postwalk inplace",function(){var n={a:[{one:"one",two:"two"},{three:"three",four:"four"}],b:{alpha
:["beta",["gamma"]],delta:"delta"}},r={a:[{one:"Zone",two:"Ztwo",X:"ZXX"},{three:"Zthree",four:"Zfour",X:"ZXX"},"ZXX"],b:{alpha:["Zbeta",["Zgamma","ZXX"],"ZXX"],delta:"Zdelta",X:"ZXX"},X:"ZXX"},i=t.clone(n),s=t.prewalk(i,function(t){return e.type(t)==="array"?t.push("XX"):e.type(t)==="object"?t.X="XX":t="Z"+t,t},!0);deepEqual(s,r),deepEqual(s,i)}),test("prepruneNode, postpruneNode",function(){var n=e("<div><span><b><i></i></b></span></div>")[0],r=e("<div><span></span></div>")[0].outerHTML,i;i=t.prepruneDom(n,function(e){return e.nodeName==="B"}),equal(i.outerHTML,r),notEqual(i.outerHTML,n.outerHTML),i=t.postpruneDom(n,function(e){return e.nodeName==="B"}),equal(i.outerHTML,r),notEqual(i.outerHTML,n.outerHTML)}),test("prewalkDom inplace, postwalkDom inplace",function(){var n=e("<div><span><b><i></i></b><p><b></b></p><div><i></i></div></span></div>")[0],r=e("<div><span><b><i><span>X</span></i><span>X</span></b><p><b><span>X</span></b><span>X</span></p><div><i><span>X</span></i><span>X</span></div><span>X</span></span><span>X</span></div>"
)[0],i=n.cloneNode(!0),s=0,o=t.prewalkDom(i,function(t){return e("<span>X</span>")[0].outerHTML!==t.outerHTML?e(t).append("<span>X</span>"):s+=1,t},!0),u=n.cloneNode(!0),a=t.postwalkDom(u,function(t){return e(t).append("<span>X</span>"),t},!0);equal(s,8),equal(o.outerHTML,r.outerHTML),equal(a.outerHTML,r.outerHTML),equal(o.outerHTML,i.outerHTML),equal(a.outerHTML,u.outerHTML)})})