Aloha.require(["jquery","aloha/ephemera","dom-to-xhtml/dom-to-xhtml"],function(e,t,n){module("ephemeral"),test("prune",function(){var n=e('<div data-xx="xx"><p class="someclass aloha-xxx aloha-xxx2"><div class="wrapper"><div class="aloha-xxx"><span class="filler">some<div class="aloha-xxx"><b class="">text</b></div>text<i>some</i></span></div></div></p><span class="attr" contenteditable="true">other<p class="ephemeral"><b class>te</b></p>xt</span></div>')[0],r=e('<div><p class="someclass"><div>some<div><b class="">text</b></div>text<i>some</i></div></p><span class="attr">otherxt</span></div>')[0];e("#test-editable").aloha().append(n),t.markAttr(e(n).find(".attr")[0],"contentEditable"),t.markElement(e(n).find(".ephemeral")[0]),t.markWrapper(e(n).find(".wrapper")[0]),t.markFiller(e(n).find(".filler")[0]),t.classes("aloha-xxx","aloha-xxx2"),t.attributes("data-xx");var i=t.prune(n);equal(i.outerHTML,r.outerHTML)}),test("emap.attrMap and emap.attrRxs",function(){var r=e('<div><ul><li nodeIndex23445="xx" sizCache232="xx" data-not-removed="not-removed" sizSetabcd123="xx" sizCache="xx" tabIndex="">some text</li></ul><table contentEditable="true"><tr><td>some</td><td>text</td></tr></table><p hidefocus="true"><span hideFocus="true"></span><span nodeindexabcd123="xx" sizcacher44="" sizsetvok4t43="xx" jqueryf9jr49="xdvd" tabindex="99">some text</span></p></div>'
)[0];e("#test-editable").aloha().append(r);var i=e('<div><ul><li data-not-removed="not-removed">some text</li></ul><table><tr><td>some</td><td>text</td></tr></table><p><span></span><span>some text</span></p></div>')[0],s=t.prune(r.cloneNode(!0)).outerHTML;e.browser.msie&&parseInt(e.browser.version,10)<9&&(s=s.replace(/\shideFocus/gi,"")),equal(s,i.outerHTML),i=n.nodeToXhtml(i),s=n.nodeToXhtml(r,t.ephemera()),equal(s,i)})})